<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>AUTO KETTLE</title>
        <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename="imgs/favicon.ico") }}">
        <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    </head>

    <body>
        <div align=center><h1>AUTO KETTLE</h1>

            <form action="/data" method = "POST">
                <p>GPIO pin to use <input type="text" name="GPIO_pin", placeholder="1-40" required=True/></p>
                <p>Water temperature<br>30°C<input type="range" min="30" max="100" value="80" name="kettle_temp" id="kettle_temp">100°C</p>
                <p><input type="submit" value="Submit"/></p>
            </form>

            <form action="/heat" method="GET">
                <p><button name="heat_button" type="submit">Heat up the kettle</button></p>
            </form>
            
        </div>

        <div id="temp_data" style="position: fixed; bottom: 0; width: 100%;"></div>

        <script>
            // Websocket data
            var data = []
            const socket = new WebSocket('ws://' + location.host + '/graph');
                socket.addEventListener('message', ev => {
                document.getElementById('temp_data').innerHTML = `current temperature: ${ev.data}`;
                data.push(ev.data)
                chart.updateSeries([
                    {
                        data: data
                    }
                ]);
            });
        </script>

        <div id="chart" style="position: fixed; bottom: 0; width: 100%;"></div>

        <script>
            var options = {
                series: [{
                    name: 'temperature',
                    data: data.slice()
                }],
                chart: {
                    height: 200,
                    type: 'area',
                    animations: {
                        easing: 'linear',
                        dynamicAnimation: {
                            speed: 1000
                    }},
                    toolbar: {
                        show: false
                    },
                    zoom: {
                        enabled: false
                }},
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    curve: 'smooth'
                },
                title: {
                    text: 'Temperature Monitor',
                    align: 'left'
                },
                xaxis: {
                    range: 10,
                    tooltip: {
                        enabled: false
                    },
                    labels: {
                        show: false
                }}
            };

            var chart = new ApexCharts(document.querySelector("#chart"), options);
            chart.render();

            window.setInterval(function () {
                getNewSeries(lastDate, {
                    min: 10,
                    max: 90
                })
                chart.updateSeries([{
                    data: data
                }])
                }, 1000)

        </script>
    </body>

</html>